<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FXageAI â€“ Live P2P Arbitrage</title>
<style>
body { margin:0; font-family:Arial; background:#0f172a; color:#e5e7eb; }
header { background:#020617; padding:12px; text-align:center; }
#status { color:#22c55e; font-size:14px; }
.container {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:10px; padding:10px;
}
.card { background:#020617; border-radius:12px; padding:10px; min-height:300px; }
.kes { background:linear-gradient(135deg,#0b6623,#000); }
.ugx { background:linear-gradient(135deg,#000,#ffd700,#d32f2f); }
.tzs { background:linear-gradient(135deg,#1b5e20,#fdd835,#1565c0); }

table { width:100%; border-collapse:collapse; font-size:14px; color:#e5e7eb; }
th,td { padding:4px; text-align:right; border-bottom:1px solid #334155; }
th { color:#93c5fd; }

#advisory { margin:10px; padding:10px; background:#020617; border-radius:12px; font-size:14px; }
.good { color:#22c55e; }
.bad { color:#ef4444; }
.platform { font-weight:bold; font-size:12px; color:#facc15; }
</style>
</head>
<body>

<header>
  <h2>FXageAI â€“ Live P2P Arbitrage</h2>
  <div id="status">Connectingâ€¦</div>
</header>

<div class="container">
  <div class="card kes"><h3>ðŸ‡°ðŸ‡ª KES</h3><div id="KES"></div></div>
  <div class="card ugx"><h3>ðŸ‡ºðŸ‡¬ UGX â†’ KES</h3><div id="UGX"></div></div>
  <div class="card tzs"><h3>ðŸ‡¹ðŸ‡¿ TZS â†’ KES</h3><div id="TZS"></div></div>
</div>

<div id="advisory">
  <h3>Advisory</h3>
  <div id="advice">Waiting for pricesâ€¦</div>
</div>

<script>
/* ================= CONFIG ================= */
const BACKEND = "https://fxageai-p2p-backend.onrender.com";
const CAPITAL = 100000;
const FX = { UGX: 1/37.5, TZS: 1/18.2 };

/* ================= FETCH ================= */
async function load(fiat){
  const r = await fetch(`${BACKEND}/p2p?fiat=${fiat}`);
  return await r.json();
}

/* ================= RENDER ================= */
function renderTable(platformName, data, fx=1){
  if(!data?.buy?.length || !data?.sell?.length) return "No data";

  let html = `<div class="platform">${platformName}</div><table>
  <tr><th>Buy</th><th>Sell</th></tr>`;

  for(let i=0;i<Math.min(10,data.buy.length);i++){
    const buy = Number(data.buy[i].adv.price) * fx;
    const sell = Number(data.sell[i].adv.price) * fx;
    html += `<tr><td>${buy.toFixed(2)}</td><td>${sell.toFixed(2)}</td></tr>`;
  }
  html += "</table>";
  return html;
}

/* ================= MAIN LOOP ================= */
async function refresh(){
  try{
    document.getElementById("status").innerText="Live â€¢ updatingâ€¦";

    const kes = await load("KES");
    const ugx = await load("UGX");
    const tzs = await load("TZS");

    document.getElementById("KES").innerHTML =
      renderTable("Binance", kes.binance) + renderTable("OKX", kes.okx);

    document.getElementById("UGX").innerHTML =
      renderTable("Binance", ugx.binance, FX.UGX) + renderTable("OKX", ugx.okx, FX.UGX);

    document.getElementById("TZS").innerHTML =
      renderTable("Binance", tzs.binance, FX.TZS) + renderTable("OKX", tzs.okx, FX.TZS);

    /* Advisory: compare UGX â†’ KES */
    const buyUGX = Number(ugx.binance.buy[0].adv.price) * FX.UGX;
    const sellKES = Number(kes.binance.sell[0].adv.price);

    const spread = sellKES - buyUGX;
    const profit = (spread / buyUGX) * CAPITAL;

    document.getElementById("advice").innerHTML =
      profit > 1000
      ? `<span class="good">Estimated profit â‰ˆ KES ${profit.toFixed(0)}</span>`
      : `<span class="bad">Spread too low (capital protected)</span>`;

  } catch(e){
    console.log(e);
    document.getElementById("status").innerText="Backend waking upâ€¦";
  }
}

refresh();
setInterval(refresh,5000);
</script>

</body>
</html>
