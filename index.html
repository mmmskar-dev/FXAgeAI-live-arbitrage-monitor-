<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>FXageAI â€“ P2P Arbitrage Monitor</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #0f172a;
  color: #e5e7eb;
}
header {
  padding: 12px;
  text-align: center;
  background: #020617;
}
#status {
  font-size: 14px;
  color: #22c55e;
}
.container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 10px;
  padding: 10px;
}
.card {
  border-radius: 12px;
  padding: 10px;
  background: #020617;
}
.kes { background: linear-gradient(135deg,#0b6623,#000); }
.ugx { background: linear-gradient(135deg,#000,#ffd700,#d32f2f); }
.tzs { background: linear-gradient(135deg,#1b5e20,#fdd835,#1565c0); }

table {
  width: 100%;
  font-size: 13px;
  border-collapse: collapse;
}
th, td {
  padding: 4px;
  text-align: right;
}
th { color: #93c5fd; }

#advisory {
  margin: 10px;
  padding: 10px;
  border-radius: 12px;
  background: #020617;
}
.good { color: #22c55e; }
.bad { color: #ef4444; }
</style>
</head>

<body>

<header>
  <h2>FXageAI â€“ Live P2P Arbitrage</h2>
  <div id="status">Connectingâ€¦</div>
</header>

<div class="container">
  <div class="card kes">
    <h3>ðŸ‡°ðŸ‡ª KES</h3>
    <div id="kes"></div>
  </div>

  <div class="card ugx">
    <h3>ðŸ‡ºðŸ‡¬ UGX (KES)</h3>
    <div id="ugx"></div>
  </div>

  <div class="card tzs">
    <h3>ðŸ‡¹ðŸ‡¿ TZS (KES)</h3>
    <div id="tzs"></div>
  </div>
</div>

<div id="advisory">
  <h3>Advisory</h3>
  <div id="advice">Waiting for dataâ€¦</div>
</div>

<script>
/* ================= CONFIG ================= */
const BACKEND = "https://fxageai-p2p-backend.onrender.com";
const CAPITAL_KES = 100000;

/* FX mid-market (can later be automated) */
const FX = {
  UGX: 1 / 37.5,
  TZS: 1 / 18.2
};

/* ================= FETCH ================= */
async function getP2P(fiat) {
  const r = await fetch(`${BACKEND}/p2p?fiat=${fiat}`);
  return await r.json();
}

/* ================= RENDER ================= */
function renderTable(rows, fx = 1) {
  if (!rows || rows.length === 0) return "No data";
  let html = `<table>
    <tr><th>Buy</th><th>Sell</th></tr>`;
  rows.slice(0,5).forEach(r => {
    const buy = (r.adv?.price || r.price) * fx;
    html += `<tr>
      <td>${buy.toFixed(2)}</td>
      <td>-</td>
    </tr>`;
  });
  html += "</table>";
  return html;
}

/* ================= MAIN LOOP ================= */
async function refresh() {
  try {
    document.getElementById("status").innerText = "Live â€¢ updatingâ€¦";

    const kes = await getP2P("KES");
    const ugx = await getP2P("UGX");
    const tzs = await getP2P("TZS");

    document.getElementById("kes").innerHTML =
      renderTable(kes.binance.buy);

    document.getElementById("ugx").innerHTML =
      renderTable(ugx.binance.buy, FX.UGX);

    document.getElementById("tzs").innerHTML =
      renderTable(tzs.binance.buy, FX.TZS);

    /* Advisory */
    const kesBuy = kes.binance.buy?.[0]?.adv?.price || 0;
    const ugxBuy = (ugx.binance.buy?.[0]?.adv?.price || 0) * FX.UGX;

    const spread = kesBuy - ugxBuy;
    const profit = spread * (CAPITAL_KES / kesBuy);

    document.getElementById("advice").innerHTML =
      profit > 1000
      ? `<span class="good">Possible profit â‰ˆ KES ${profit.toFixed(0)}</span>`
      : `<span class="bad">Spread too low (protected)</span>`;

  } catch (e) {
    document.getElementById("status").innerText = "Backend waking upâ€¦";
  }
}

refresh();
setInterval(refresh, 5000);
</script>

</body>
</html>
